<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  <Fragment>
    
    <!-- Application Files Component Group - Auto-generated -->
    <ComponentGroup Id="ApplicationFiles" Directory="INSTALLFOLDER">
      
      <!-- Main executable -->
      <Component Id="MainExecutable" Guid="{A1234567-89AB-CDEF-0123-456789ABCDEF}">
        <File Id="BucketExe" 
              Source="$(var.AppBinariesPath)\Bucket.exe" 
              KeyPath="yes" />
        
        <!-- Registry entries for uninstall -->
        <RegistryValue Root="HKLM" 
                       Key="SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(var.ProductGuid)" 
                       Name="DisplayName" 
                       Value="$(var.ProductName)" 
                       Type="string" 
                       KeyPath="no" />
        <RegistryValue Root="HKLM" 
                       Key="SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(var.ProductGuid)" 
                       Name="DisplayVersion" 
                       Value="$(var.Version)" 
                       Type="string" 
                       KeyPath="no" />
      </Component>

      <!-- Application DLLs and dependencies -->
      <Component Id="ApplicationDlls" Guid="{B2345678-9ABC-DEF0-1234-56789ABCDEF0}">
        <!-- Core application DLLs -->
        <File Id="BucketCoreDll" Source="$(var.AppBinariesPath)\Bucket.Core.dll" />
        
        <!-- .NET Runtime files (if published as self-contained) -->
        <File Id="HostFxr" Source="$(var.AppBinariesPath)\hostfxr.dll" Condition="Exists('$(var.AppBinariesPath)\hostfxr.dll')" />
        <File Id="HostPolicy" Source="$(var.AppBinariesPath)\hostpolicy.dll" Condition="Exists('$(var.AppBinariesPath)\hostpolicy.dll')" />
        
        <!-- WinUI3 dependencies -->
        <File Id="MicrosoftWinUIDll" Source="$(var.AppBinariesPath)\Microsoft.WinUI.dll" Condition="Exists('$(var.AppBinariesPath)\Microsoft.WinUI.dll')" />
        <File Id="WinRTRuntimeDll" Source="$(var.AppBinariesPath)\WinRT.Runtime.dll" Condition="Exists('$(var.AppBinariesPath)\WinRT.Runtime.dll')" />
        <File Id="MicrosoftWindowsAppSdk" Source="$(var.AppBinariesPath)\Microsoft.WindowsAppSDK.dll" Condition="Exists('$(var.AppBinariesPath)\Microsoft.WindowsAppSDK.dll')" />
      </Component>

      <!-- Configuration and metadata files -->
      <Component Id="ConfigFiles" Guid="{C3456789-ABCD-EF01-2345-6789ABCDEF01}">
        <File Id="RuntimeConfigJson" Source="$(var.AppBinariesPath)\Bucket.runtimeconfig.json" Condition="Exists('$(var.AppBinariesPath)\Bucket.runtimeconfig.json')" />
        <File Id="DepsJson" Source="$(var.AppBinariesPath)\Bucket.deps.json" Condition="Exists('$(var.AppBinariesPath)\Bucket.deps.json')" />
        <File Id="AppHostExe" Source="$(var.AppBinariesPath)\apphost.exe" Condition="Exists('$(var.AppBinariesPath)\apphost.exe')" />
      </Component>

      <!-- Resources and assets -->
      <Component Id="AppAssets" Guid="{D4567890-BCDE-F012-3456-789ABCDEF012}">
        <!-- Create the directory, files will be added by Heat during build if needed -->
        <CreateFolder />
      </Component>

    </ComponentGroup>

    <!-- Desktop Shortcut -->
    <ComponentGroup Id="DesktopShortcut" Directory="DesktopFolder">
      <Component Id="DesktopShortcutComponent" Guid="{E5678901-CDEF-0123-4567-89ABCDEF0123}">
        <Shortcut Id="DesktopShortcut"
                  Name="$(var.ProductName)"
                  Description="Launch $(var.ProductName)"
                  Target="[INSTALLFOLDER]Bucket.exe"
                  WorkingDirectory="INSTALLFOLDER"
                  Icon="AppIcon.ico" />
        <RegistryValue Root="HKCU" 
                       Key="SOFTWARE\$(var.Manufacturer)\$(var.ProductName)\Shortcuts" 
                       Name="Desktop" 
                       Value="1" 
                       Type="integer" 
                       KeyPath="yes" />
      </Component>
    </ComponentGroup>

    <!-- Start Menu Shortcut -->
    <ComponentGroup Id="StartMenuShortcut" Directory="STARTMENUDIR">
      <Component Id="StartMenuShortcutComponent" Guid="{F6789012-DEF0-1234-5678-9ABCDEF01234}">
        <Shortcut Id="StartMenuShortcut"
                  Name="$(var.ProductName)"
                  Description="Launch $(var.ProductName)"
                  Target="[INSTALLFOLDER]Bucket.exe"
                  WorkingDirectory="INSTALLFOLDER"
                  Icon="AppIcon.ico" />
        
        <!-- Uninstall shortcut -->
        <Shortcut Id="UninstallShortcut"
                  Name="Uninstall $(var.ProductName)"
                  Description="Uninstall $(var.ProductName)"
                  Target="[SystemFolder]msiexec.exe"
                  Arguments="/x [ProductCode]" />
        
        <RegistryValue Root="HKCU" 
                       Key="SOFTWARE\$(var.Manufacturer)\$(var.ProductName)\Shortcuts" 
                       Name="StartMenu" 
                       Value="1" 
                       Type="integer" 
                       KeyPath="yes" />
        
        <!-- Remove start menu folder on uninstall -->
        <RemoveFolder Id="RemoveStartMenuDir" On="uninstall" />
      </Component>
    </ComponentGroup>

  </Fragment>
</Wix>
