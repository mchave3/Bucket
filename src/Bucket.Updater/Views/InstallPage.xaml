<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="Bucket.Updater.Views.InstallPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dev="using:DevWinUI"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" MinHeight="200" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  Header  -->
        <StackPanel
            Grid.Row="0"
            Margin="0,0,0,32"
            HorizontalAlignment="Center"
            Spacing="8">
            <TextBlock
                HorizontalAlignment="Center"
                FontSize="28"
                FontWeight="Bold"
                Text="{x:Bind ViewModel.HeaderText, Mode=OneWay}" />
            <TextBlock
                HorizontalAlignment="Center"
                FontSize="16"
                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                Text="{x:Bind ViewModel.UpdateVersion, Mode=OneWay}" />
        </StackPanel>

        <!--  Install Content  -->
        <StackPanel
            Grid.Row="1"
            Width="600"
            Margin="0,16,0,24"
            HorizontalAlignment="Center"
            VerticalAlignment="Top"
            Spacing="24">

            <!--  Installation Logs  -->
            <Border
                MinHeight="200"
                MaxHeight="500"
                Padding="16"
                HorizontalAlignment="Stretch"
                Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                CornerRadius="8">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <TextBlock
                        Grid.Row="0"
                        Margin="0,0,0,12"
                        FontWeight="SemiBold"
                        Text="Installation Details" />

                    <ScrollViewer
                        x:Name="LogScrollViewer"
                        Grid.Row="1"
                        HorizontalScrollBarVisibility="Auto"
                        VerticalScrollBarVisibility="Auto"
                        VerticalScrollMode="Auto"
                        ZoomMode="Disabled">
                        <TextBlock
                            Margin="8,0,8,0"
                            FontFamily="Consolas"
                            FontSize="12"
                            IsTextSelectionEnabled="True"
                            Text="{x:Bind ViewModel.InstallationLog, Mode=OneWay}"
                            TextWrapping="Wrap" />
                    </ScrollViewer>
                </Grid>
            </Border>

        </StackPanel>

        <!--  Success/Error Messages  -->
        <StackPanel
            Grid.Row="2"
            Width="600"
            Margin="0,16,0,16"
            HorizontalAlignment="Center"
            Spacing="12">
            <!--  Success Message  -->
            <InfoBar
                Title="Installation Completed"
                HorizontalAlignment="Stretch"
                IsClosable="False"
                IsOpen="{x:Bind ViewModel.IsCompleted, Mode=OneWay}"
                Message="The update has been installed successfully. Please restart the application to use the new version."
                Severity="Success" />

            <!--  Error Message  -->
            <InfoBar
                Title="Update Failed"
                HorizontalAlignment="Stretch"
                IsClosable="False"
                IsOpen="{x:Bind ViewModel.HasError, Mode=OneWay}"
                Message="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}"
                Severity="Error" />
        </StackPanel>

        <!--  Navigation Buttons  -->
        <StackPanel
            Grid.Row="3"
            Margin="0,8,0,0"
            HorizontalAlignment="Right"
            Orientation="Horizontal"
            Spacing="12">

            <Button
                x:Name="CancelButton"
                Command="{x:Bind ViewModel.CancelCommand}"
                Content="Cancel"
                Visibility="{x:Bind ViewModel.CancelButtonVisibility, Mode=OneWay}" />

            <Button
                x:Name="RetryButton"
                Command="{x:Bind ViewModel.RetryCommand}"
                Content="Retry"
                Style="{ThemeResource AccentButtonStyle}"
                Visibility="{x:Bind ViewModel.RetryButtonVisibility, Mode=OneWay}" />

            <Button
                x:Name="FinishButton"
                Command="{x:Bind ViewModel.FinishCommand}"
                Content="Finish"
                Style="{ThemeResource AccentButtonStyle}"
                Visibility="{x:Bind ViewModel.FinishButtonVisibility, Mode=OneWay}" />

        </StackPanel>

    </Grid>
</Page>